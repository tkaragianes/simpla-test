<link rel="import" href="../polymer/polymer.html"> <link rel="import" href="../simpla-styles/simpla-styles.html"> <link rel="import" href="../simpla-styles/simple.html"> <link rel="import" href="../simple-button/simple-button.html"> <link rel="import" href="../simple-modal/simple-modal.html"> <dom-module id="simpla-login"> <template> <style>*,::after,::before,:host{box-sizing:border-box}:host{font-family:var(--simpla-font-family);font-size:var(--simpla-scale-0);-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-smoothing:antialiased}.modal{--simple-modal:{@apply(--simpla-simple-modal);dummy:value};--simple-modal-title:{@apply(--simpla-simple-modal-title);dummy:value};--simple-modal-overlay:var(--simpla-simple-modal-overlay);--simple-modal-close-color:var(--simpla-simple-modal-close-color)}.form{display:flex;flex-direction:column;width:15em}.form__fieldset{border:0;padding:0;margin:var(--simpla-scale-1) 0}.form__fieldset:first-child{margin-top:0}.form__label{font-size:var(--simpla-scale-000);color:var(--simpla-grey-500)}.form__input{@apply(--simpla-input);width:100%}.form[invalid] .form__input{border-color:var(--simpla-red)}.form__input:focus{border-color:var(--simpla-grey-500)}.form__submit{@apply(--simpla-button);align-self:flex-end;margin-top:var(--simpla-scale-3)}.form__error{display:flex;align-items:center;justify-content:center;font-size:var(--simpla-scale-00);color:var(--simpla-red);height:0;opacity:0;visibility:hidden;transition:height 250ms var(--simpla-easing-standard),opacity 250ms ease}.form__error[data-active]{visibility:visible;height:var(--simpla-scale-3);opacity:1}input:-webkit-autofill{box-shadow:0 0 50px 1000px #fff inset;-webkit-text-fill-color:var(--simpla-text-color)}</style> <simple-modal class="modal" title="Login" active="{{active}}" no-exit="[[busy]]"> <form id="form" class="form" invalid$="[[_hasError(error)]]" on-submit="login"> <fieldset class="form__fieldset"> <label class="form__label" for="email">Email</label> <input type="email" class="form__input" name="email" value="{{email::input}}" readonly$="[[busy]]" on-focus="_clearError"> </fieldset> <fieldset class="form__fieldset"> <label class="form__label" for="password">Password</label> <input type="password" class="form__input" name="password" value="{{password::input}}" readonly$="[[busy]]" on-focus="_clearError"> </fieldset> <div class="form__error" data-active$="[[_hasError(error)]]"> [[error]] </div> <button is="simple-button" class="form__submit" type="submit" busy="[[busy]]"> lets go </button> </form> </simple-modal> </template> <script>!function(){"use strict";var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),i={active:"opened",inactive:"closed",authenticated:"success"},n={400:"Invalid email or password",401:"Wrong email or password",500:"Something went wrong, try again?"},r=function(){function r(){e(this,r)}return t(r,[{key:"beforeRegister",value:function(){this.is="simpla-login",this.properties={active:{type:Boolean,observer:"_activeChanged",notify:!0},busy:{type:Boolean,notify:!0},error:{type:String,value:""},email:String,password:String}}},{key:"_activeChanged",value:function(e){e?this.fire(i.active):(this.fire(i.inactive),this.email="",this.password="")}},{key:"open",value:function(){this.active=!0}},{key:"close",value:function(){this.active=!1}},{key:"prompt",value:function(){var e=this;return this.open(),new Promise(function(t){e.addEventListener(i.inactive,function(){return t(Simpla.getState("authenticated"),{once:!0})})})}},{key:"login",value:function(e){var t=this,r=function(){t.busy=!1,t.active=!1,t.email="",t.password="",t.fire(i.authenticated),t.fire("simpla-notification",{text:"welcome back"})},a=function(e){t.busy=!1,t.error=n[e.code]};e&&e.preventDefault(),this.busy=!0,this.error="",Simpla.login({email:this.email,password:this.password}).then(r).catch(a)}},{key:"_hasError",value:function(e){return!!e}},{key:"_clearError",value:function(){this.error=""}}]),r}();Polymer(r)}()</script> </dom-module> 